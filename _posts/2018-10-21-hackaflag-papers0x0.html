---
title: "Hackaflag Academy - Papers 0x0"
layout: post
date: 2018-10-21
category: writeups
---

a<p>Javascript é uma linguagem muito simples e facil, tem uma base de syntaxe muito parecida com a do C, e é uma linguagem criada e desenvolvida para ser rodada em runtime, no mesmo tempo de execucao e renderização do browser.
Ela fica no browser com limitação para interagir com o servidor (isso muda um pouco com o NodeJs, mas aqui estamos falando apenas do js client-side) e também temos uma limitação grande em cima das funcoes nativas que interagem diretamente com o browser.</p>
<br>
<p>Abaixo temos um simples código em javascript:</p>
{% highlight javascript %}
var text = "hackaflag";
function mostrar(str){
  alert(str);
  return 0;
}
mostrar(text);
{% endhighlight %}

<br>
<p>Eu não vou listar cada detalhe da semantica do javascript, até porque isso sai do escopo do paper, mas vou estar mostrando aquelas semanticas mais importantes para o contexto de segurança.</p>

<p>O código anterior armazena o texto “hackaflag” na variavel text, cria uma função que recebe como paramêtro uma variavel “str” que na terceira linha abre um alert na página com esse texto. Ao final do código temos a iniciação da função passando a variavel text para dentro da função.</p>
<h2>Scripting Process Model</h2>
<p>Cada documento html mostrado no browser - seja ele separado da janela ou em um iframe - é dado separadas instancias da execução do javascript, completo com um namespace individual para todas as variaveis globais e funcoes criadas para carregar scripts. Todos os scripts sao executados no contexto de um documento particular que compartilham essa sandbox e podem,talvez, interagir com outros contextos atraves de browser-supplied APIs.</p>
<br>
<p>Sem uma execucao de contexto em particular, todos os blocos javascript encontrados sao processados individualmente e quase sempre em uma ordem bem definida. Cada bloco deve consistir de qualquer numero contido em si mesmo, unidades de sintaxe bem formatadas serao processadas em três etapas disitintas que são: analise,resolucao de função e execução de código. Ainda assim temos multiplos outros estagios se formos deixar melhor separado, mas vou citar aqueles que tem uma importancia maior.</p>
<br>
<h2>Parsing do Código</h2>
<p>O estagio de parsing valida a sintaxe do bloco de script e, casualmente, converte ela para uma representacao de um binario intermediario, que pode ser executado mais rapido. O código não tem efeitos globais antes desse passo ser executado por completo. No caso de erros de sintaxe, o bloco inteiro é descartado, e o parser prossegue para a proxima parte do código.</p>
<p>Para ilustrar o que foi dito anteriormente sobre os parsers do javascript, considere o seguinte documento:</p>
<br>
<pre>
<script>
var var1 = 1;
var var2 =
</script>
<script>
  2;
</script>
</pre>
<br>
<p>Existe algo que é necessário deixar claro, no javascript os blocos &#x3c;script&#x3e; nao sao concatenados depois do parsing.</p>
<p>Aqui temos dois blocos de scripts, o primeiro segmento vai causar um erro de sintaxe que vai fazer o bloco inteiro ser ignorado na parte de execucao. O fato que todo o segmento ser abandonado depois pode ser um problema global para a continuacao tanto do script quanto para a renderização de alguma propriedade da página, pois o efeito que irá gerar será algo parecido com o seguinte:</p>
<pre>
  <script>
  var var1 = 1;
</script>
<script>
  2;
</script>
</pre>
<br>
<p>O que vai acontecer no exemplo original nessa seção é que o primeiro bloco vai ser ignorado mas o segundo (&#x3c;script&#x3e;2;&#x3c;/script&#x3e;) vai receber o parsing corretamente. Este segundo bloco sera montado para um no-op quando executado, de qualquer forma, por causa disso ele usa uma pura e numerica expressão para sua declaração.</p>
